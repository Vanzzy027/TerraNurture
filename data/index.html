<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerraNurture - Smart Irrigation</title>
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Code+Pro:wght@300;400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-seedling"></i>
                    <h1>TerraNurture</h1>
                </div>
                <p class="tagline">Smart Soil Management</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-target="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#controls" class="nav-item" data-target="controls">
                    <i class="fas fa-cogs"></i>
                    <span>Controls</span>
                </a>
                <a href="#calibration" class="nav-item" data-target="calibration">
                    <i class="fas fa-sliders-h"></i>
                    <span>Calibration</span>
                </a>
                <a href="#logs" class="nav-item" data-target="logs">
                    <i class="fas fa-history"></i>
                    <span>Event Logs</span>
                </a>
                <a href="#system" class="nav-item" data-target="system">
                    <i class="fas fa-microchip"></i>
                    <span>System Info</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <div class="connection-status">
                    <div class="status-indicator" id="wifiStatus"></div>
                    <span id="connectionText">Connecting...</span>
                </div>
                <div class="uptime" id="uptimeDisplay">Uptime: 00:00:00</div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Panel -->
            <div class="content-panel active" id="dashboard">
                <div class="panel-header">
                    <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                    <div class="last-update" id="lastUpdate">Last update: --</div>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Moisture Card -->
                    <div class="card moisture-card">
                        <div class="card-header">
                            <h3><i class="fas fa-tint"></i> Soil Moisture</h3>
                            <div class="card-badge" id="moistureStatus">--</div>
                        </div>
                        <div class="card-body">
                            <div class="moisture-display">
                                <div class="moisture-value" id="moistureValue">--</div>
                                <div class="moisture-unit">%</div>
                            </div>
                            <div class="moisture-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="moistureBar"></div>
                                    <div class="progress-threshold" id="thresholdMarker"></div>
                                </div>
                                <div class="progress-labels">
                                    <span>Dry (0%)</span>
                                    <span id="thresholdLabel">Threshold: 45%</span>
                                    <span>Wet (100%)</span>
                                </div>
                            </div>
                            <div class="moisture-details">
                                <div class="detail-item">
                                    <span class="detail-label">Raw ADC:</span>
                                    <span class="detail-value" id="rawAdc">--</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Sensor Age:</span>
                                    <span class="detail-value" id="sensorAge">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pump Control Card -->
                    <div class="card pump-card">
                        <div class="card-header">
                            <h3><i class="fas fa-faucet"></i> Pump Control</h3>
                            <div class="status-badge" id="pumpStatusBadge">IDLE</div>
                        </div>
                        <div class="card-body">
                            <div class="pump-visual">
                                <div class="pump-icon" id="pumpIcon">
                                    <i class="fas fa-faucet"></i>
                                </div>
                                <div class="pump-info">
                                    <div class="pump-stat">
                                        <span class="stat-label">Status:</span>
                                        <span class="stat-value" id="pumpStatusText">IDLE</span>
                                    </div>
                                    <div class="pump-stat">
                                        <span class="stat-label">Retry Count:</span>
                                        <span class="stat-value" id="retryCount">0</span>
                                    </div>
                                    <div class="pump-stat">
                                        <span class="stat-label">Last Change:</span>
                                        <span class="stat-value" id="lastChange">--</span>
                                    </div>
                                </div>
                            </div>
                            <div class="pump-controls">
                                <button class="btn btn-primary" id="manualPumpBtn">
                                    <i class="fas fa-play"></i> Manual Pump (5s)
                                </button>
                                <button class="btn btn-danger" id="emergencyStopBtn" disabled>
                                    <i class="fas fa-stop"></i> Emergency Stop
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Status Card -->
                    <div class="card system-card">
                        <div class="card-header">
                            <h3><i class="fas fa-server"></i> System Status</h3>
                        </div>
                        <div class="card-body">
                            <div class="system-stats">
                                <div class="system-stat">
                                    <i class="fas fa-wifi"></i>
                                    <div>
                                        <div class="stat-label">WiFi</div>
                                        <div class="stat-value" id="wifiRssi">-- dBm</div>
                                    </div>
                                </div>
                                <div class="system-stat">
                                    <i class="fas fa-database"></i>
                                    <div>
                                        <div class="stat-label">Storage</div>
                                        <div class="stat-value" id="storageStatus">SPIFFS</div>
                                    </div>
                                </div>
                                <div class="system-stat">
                                    <i class="fas fa-memory"></i>
                                    <div>
                                        <div class="stat-label">Free Heap</div>
                                        <div class="stat-value" id="freeHeap">-- KB</div>
                                    </div>
                                </div>
                                <div class="system-stat">
                                    <i class="fas fa-microchip"></i>
                                    <div>
                                        <div class="stat-label">CPU Freq</div>
                                        <div class="stat-value">240 MHz</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions Card -->
                    <div class="card actions-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                        </div>
                        <div class="card-body">
                            <div class="quick-actions">
                                <button class="action-btn" id="refreshBtn">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Refresh</span>
                                </button>
                                <button class="action-btn" id="calibrateDryBtn">
                                    <i class="fas fa-sun"></i>
                                    <span>Calibrate Dry</span>
                                </button>
                                <button class="action-btn" id="calibrateWetBtn">
                                    <i class="fas fa-water"></i>
                                    <span>Calibrate Wet</span>
                                </button>
                                <button class="action-btn" id="downloadLogsBtn">
                                    <i class="fas fa-download"></i>
                                    <span>Download Logs</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Controls Panel -->
            <div class="content-panel" id="controls">
                <div class="panel-header">
                    <h2><i class="fas fa-cogs"></i> System Controls</h2>
                </div>
                <div class="controls-grid">
                    <!-- Configuration Card -->
                    <div class="card config-card">
                        <div class="card-header">
                            <h3><i class="fas fa-sliders-h"></i> Configuration</h3>
                        </div>
                        <div class="card-body">
                            <form id="configForm">
                                <div class="form-group">
                                    <label for="dryThreshold">
                                        <i class="fas fa-thermometer-empty"></i> Dry Threshold (%)
                                    </label>
                                    <div class="input-with-unit">
                                        <input type="number" id="dryThreshold" min="0" max="100" step="0.1" value="45.0">
                                        <span class="input-unit">%</span>
                                    </div>
                                    <div class="form-help">Pump activates below this value</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="expectedValue">
                                        <i class="fas fa-bullseye"></i> Target Moisture (%)
                                    </label>
                                    <div class="input-with-unit">
                                        <input type="number" id="expectedValue" min="0" max="100" step="0.1" value="60.0">
                                        <span class="input-unit">%</span>
                                    </div>
                                    <div class="form-help">Watering stops when reached</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="maxRetries">
                                        <i class="fas fa-redo"></i> Max Retries
                                    </label>
                                    <input type="number" id="maxRetries" min="1" max="10" step="1" value="3">
                                    <div class="form-help">Maximum watering attempts per cycle</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="samplingInterval">
                                        <i class="fas fa-clock"></i> Sampling Interval
                                    </label>
                                    <div class="input-with-unit">
                                        <input type="number" id="samplingInterval" min="1000" max="60000" step="1000" value="3000">
                                        <span class="input-unit">ms</span>
                                    </div>
                                    <div class="form-help">Time between sensor readings</div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Configuration
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="resetConfigBtn">
                                        <i class="fas fa-undo"></i> Reset to Defaults
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Advanced Controls Card -->
                    <div class="card advanced-card">
                        <div class="card-header">
                            <h3><i class="fas fa-rocket"></i> Advanced Controls</h3>
                        </div>
                        <div class="card-body">
                            <div class="advanced-controls">
                                <div class="control-group">
                                    <h4><i class="fas fa-water"></i> Pump Testing</h4>
                                    <div class="control-item">
                                        <button class="btn btn-test" id="testPump1s">
                                            <i class="fas fa-play"></i> Test 1s
                                        </button>
                                        <button class="btn btn-test" id="testPump3s">
                                            <i class="fas fa-play"></i> Test 3s
                                        </button>
                                        <button class="btn btn-test" id="testPump5s">
                                            <i class="fas fa-play"></i> Test 5s
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <h4><i class="fas fa-broom"></i> System Maintenance</h4>
                                    <div class="control-item">
                                        <button class="btn btn-warning" id="clearLogsBtn">
                                            <i class="fas fa-trash"></i> Clear Logs
                                        </button>
                                        <button class="btn btn-warning" id="restartSystemBtn">
                                            <i class="fas fa-power-off"></i> Restart System
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <h4><i class="fas fa-chart-line"></i> Performance</h4>
                                    <div class="performance-metrics">
                                        <div class="metric">
                                            <span class="metric-label">Update Interval:</span>
                                            <span class="metric-value" id="updateInterval">3000 ms</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Response Time:</span>
                                            <span class="metric-value" id="responseTime">-- ms</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Data Points:</span>
                                            <span class="metric-value" id="dataPoints">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Calibration Panel -->
            <div class="content-panel" id="calibration">
                <div class="panel-header">
                    <h2><i class="fas fa-sliders-h"></i> Sensor Calibration</h2>
                </div>
                <div class="calibration-content">
                    <div class="calibration-card card">
                        <div class="card-header">
                            <h3><i class="fas fa-ruler-combined"></i> Calibration Guide</h3>
                        </div>
                        <div class="card-body">
                            <div class="calibration-steps">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Dry Calibration</h4>
                                        <p>Take sensor out of soil, wipe dry, and click "Calibrate Dry"</p>
                                        <div class="step-action">
                                            <button class="btn btn-secondary" id="calibrateDryBtn">
                                                <i class="fas fa-sun"></i> Calibrate Dry
                                            </button>
                                            <div class="calibration-result" id="dryResult">Not calibrated</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>Wet Calibration</h4>
                                        <p>Submerge sensor in water (not soil) and click "Calibrate Wet"</p>
                                        <div class="step-action">
                                            <button class="btn btn-secondary" id="calibrateWetBtn">
                                                <i class="fas fa-water"></i> Calibrate Wet
                                            </button>
                                            <div class="calibration-result" id="wetResult">Not calibrated</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h4>Current Values</h4>
                                        <div class="calibration-values">
                                            <div class="cal-value">
                                                <span class="cal-label">ADC Dry:</span>
                                                <span class="cal-data" id="adcDryValue">4095</span>
                                            </div>
                                            <div class="cal-value">
                                                <span class="cal-label">ADC Wet:</span>
                                                <span class="cal-data" id="adcWetValue">1500</span>
                                            </div>
                                            <div class="cal-value">
                                                <span class="cal-label">Current ADC:</span>
                                                <span class="cal-data" id="currentAdc">--</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="calibration-chart card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Calibration Curve</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="calibrationChart"></canvas>
                            </div>
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <span class="legend-color dry-color"></span>
                                    <span>Dry Calibration Point</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color wet-color"></span>
                                    <span>Wet Calibration Point</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color current-color"></span>
                                    <span>Current Reading</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Logs Panel -->
            <div class="content-panel" id="logs">
                <div class="panel-header">
                    <h2><i class="fas fa-history"></i> Event Logs</h2>
                    <div class="panel-actions">
                        <button class="btn btn-secondary" id="refreshLogsBtn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-primary" id="downloadLogsBtn2">
                            <i class="fas fa-download"></i> Download CSV
                        </button>
                        <button class="btn btn-danger" id="clearLogsBtn2">
                            <i class="fas fa-trash"></i> Clear Logs
                        </button>
                    </div>
                </div>
                
                <div class="logs-container">
                    <div class="logs-controls">
                        <div class="logs-filter">
                            <select id="logFilter">
                                <option value="all">All Events</option>
                                <option value="sensor">Sensor Reads</option>
                                <option value="pump">Pump Events</option>
                                <option value="system">System Events</option>
                            </select>
                            <input type="text" id="logSearch" placeholder="Search logs...">
                        </div>
                    </div>
                    
                    <div class="logs-table-container">
                        <table class="logs-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Event</th>
                                    <th>ADC Value</th>
                                    <th>Moisture %</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="logsTableBody">
                                <!-- Logs will be populated here -->
                                <tr>
                                    <td colspan="5" class="no-logs">Loading logs...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="logs-pagination">
                        <button class="btn btn-sm" id="prevPageBtn" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
                        <button class="btn btn-sm" id="nextPageBtn" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- System Info Panel -->
            <div class="content-panel" id="system">
                <div class="panel-header">
                    <h2><i class="fas fa-microchip"></i> System Information</h2>
                </div>
                <div class="system-info-grid">
                    <div class="card hardware-card">
                        <div class="card-header">
                            <h3><i class="fas fa-microchip"></i> Hardware</h3>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">MCU:</span>
                                    <span class="info-value">ESP32 (Node32s)</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">CPU Cores:</span>
                                    <span class="info-value">2 @ 240MHz</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Flash Size:</span>
                                    <span class="info-value">4 MB</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">PSRAM:</span>
                                    <span class="info-value">8 MB</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">ADC Pin:</span>
                                    <span class="info-value">GPIO 34</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Relay Pin:</span>
                                    <span class="info-value">GPIO 25</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card software-card">
                        <div class="card-header">
                            <h3><i class="fas fa-code"></i> Software</h3>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Firmware:</span>
                                    <span class="info-value">TerraNurture v2.0</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Arduino Core:</span>
                                    <span class="info-value">ESP32 v3.1.1</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">FreeRTOS:</span>
                                    <span class="info-value">v10.4.3</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Web Server:</span>
                                    <span class="info-value">ESPAsyncWebServer</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">File System:</span>
                                    <span class="info-value">SPIFFS</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Build Date:</span>
                                    <span class="info-value" id="buildDate">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card network-card">
                        <div class="card-header">
                            <h3><i class="fas fa-network-wired"></i> Network</h3>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">IP Address:</span>
                                    <span class="info-value" id="ipAddress">--</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">MAC Address:</span>
                                    <span class="info-value" id="macAddress">--</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">SSID:</span>
                                    <span class="info-value">Amrit</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Gateway:</span>
                                    <span class="info-value" id="gateway">--</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Subnet Mask:</span>
                                    <span class="info-value" id="subnetMask">--</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">DNS Server:</span>
                                    <span class="info-value" id="dnsServer">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card memory-card">
                        <div class="card-header">
                            <h3><i class="fas fa-memory"></i> Memory</h3>
                        </div>
                        <div class="card-body">
                            <div class="memory-chart">
                                <canvas id="memoryChart"></canvas>
                            </div>
                            <div class="memory-stats">
                                <div class="memory-stat">
                                    <span class="stat-label">Free Heap:</span>
                                    <span class="stat-value" id="freeHeapDetailed">-- KB</span>
                                </div>
                                <div class="memory-stat">
                                    <span class="stat-label">Min Free:</span>
                                    <span class="stat-value" id="minHeap">-- KB</span>
                                </div>
                                <div class="memory-stat">
                                    <span class="stat-label">PSRAM Size:</span>
                                    <span class="stat-value">8192 KB</span>
                                </div>
                                <div class="memory-stat">
                                    <span class="stat-label">SPIFFS Used:</span>
                                    <span class="stat-value" id="spiffsUsed">-- KB</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/app.js"></script>
</body>
</html>